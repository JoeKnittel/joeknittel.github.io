---
title: R Markdown Test
output:
md_document:
variant: gfm
preserve_yaml: TRUE
knit: (function(inputFile, encoding) {
rmarkdown::render(inputFile, encoding = encoding, output_dir = "_posts") })
author: "Joe"
date: '2021-01-28 05:01:01'
layout: post
---
```{r setup, include=FALSE}
base_dir <- "~/GitHub/joeknittel.github.io" # i.e. where the jekyll blog is on the hard drive.
base_url <- "/" # keep as is
fig_path <- "images/" # customize to heart's content, I 'spose.
knitr::opts_knit$set(base.dir = base_dir, base.url = base_url)
knitr::opts_chunk$set(fig.path = fig_path,
cache.path = '../cache/',
message=FALSE, warning=FALSE,
cache = TRUE)
```
Let's turn off warnings, since R in Jupyter Lab tends to spit out a lot of unnecessary information while running cells.
```{r}
options(warn=-1)
```
Next, we'll load up the Tidyverse collection of packages:
```{r}
library(tidyverse)
```
In the following cell, we'll read in some .csv data (using the <a href = "https://readr.tidyverse.org/">readr package</a>) I've stored locally on my site in case it's deleted from its original source (https://support.spatialkey.com/spatialkey-sample-csv-data/). There's not too much of a description of the dataset, but it appears to be data pertaining to a collection of insurance policies in Florida from 2011-2012.
```{r}
data = read_csv("http://joeknittel.github.io/sample_data.csv")
head(data)
```
Of particular interest are the *tiv_2011* and *tiv_2012* columns. They represent the Total Insurable Value (TIV) of the policy from years 2011 and 2012.
Let's see if we can observe any trends on at the county level. Here, we'll employ the pipe operator `%>%` from the <a href = "https://magrittr.tidyverse.org/">magrittr package</a> to sum all TIV values for policies within each county, then add in a new variable that computes the percent increase in TIV from 2011 to 2012.
```{r}
grouped_data = data %>% group_by(county) %>% summarize(tiv2011 = sum(tiv_2011), tiv2012 = sum(tiv_2012), change = (tiv2012-tiv2011)/tiv2011) %>% arrange(desc(change))
head(grouped_data, 10)
```
It looks like there's a special focus on policies in Orlando, Florida, since Orlando is not a county, and its percent change in TIV was higher than that of any county in the state.
To have that data not affect the rest of our code, we'll disregard the "Orlando" row:
```{r}
grouped_data = grouped_data[-1,]
```
Let's now get an idea of the distribution of percent increase in TIV over all counties using a histogram from the <a href = "https://ggplot2.tidyverse.org/">ggplot2 package</a>:
```{r}
ggplot(data = grouped_data) + geom_histogram(mapping = aes(x = change))
```
It appears as though most counties saw an increase in TIV, with an average of around 20% increase.
```{r}
mean(grouped_data$change)
```
# Bonus
As a demonstration of things to come, we'll create a map of the percent change in TIV. To do this, we'll need a few additional packages (see documentation <a href = "https://urbaninstitute.github.io/urbnmapr/">here</a> and <a href = "https://urbaninstitute.github.io/urbnthemes/articles/introducing-urbnthemes.html">here</a>) from the <a href = "https://www.urban.org/aboutus">Urban Institute</a>, so head over to your R console and run the lines:
```r
install.packages("devtools")
devtools::install_github("UrbanInstitute/urbnmapr")
install.packages("remotes")
